WARNING:bayesflow:
When using torch backend, we need to disable autograd by default to avoid excessive memory usage. Use

with torch.enable_grad():
    ...

in contexts where you need gradients (e.g. custom training loops).
[I 2025-04-17 21:19:31,869] A new study created in memory with name: no-name-0483b6a4-305d-47a7-aaf5-63da9a2df421
[I 2025-04-17 21:34:06,795] Trial 0 finished with value: 0.7640275003198991 and parameters: {'t1_value': 0.00558535271150224, 's_shift_cosine': 7.732335085502827, 'tau_1': 0.6037450519199123, 'delta_tau_2': 0.17797787337067944}. Best is trial 0 with value: 0.7640275003198991.
[I 2025-04-17 21:48:24,371] Trial 1 finished with value: 0.531148347917356 and parameters: {'t1_value': 0.0027855499471254363, 's_shift_cosine': 8.472006906945376, 'tau_1': 0.8786938024415303, 'delta_tau_2': 0.07264978153018271}. Best is trial 1 with value: 0.531148347917356.
[I 2025-04-17 22:02:53,789] Trial 2 finished with value: 0.7871531549043822 and parameters: {'t1_value': 0.008118008562479195, 's_shift_cosine': 6.104725345306616, 'tau_1': 0.8913159586299206, 'delta_tau_2': 0.13120672106889356}. Best is trial 1 with value: 0.531148347917356.
[I 2025-04-17 22:17:43,006] Trial 3 finished with value: 0.7236121853610926 and parameters: {'t1_value': 0.0008933880912532217, 's_shift_cosine': 9.719177190363556, 'tau_1': 0.7419823539063911, 'delta_tau_2': 0.25647758518311287}. Best is trial 1 with value: 0.531148347917356.
/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/bayesflow/diagnostics/metrics/root_mean_squared_error.py:61: RuntimeWarning: overflow encountered in square
  rmse = np.sqrt(np.mean((samples["estimates"] - samples["targets"][:, None, :]) ** 2, axis=0))
[W 2025-04-17 22:31:15,447] Trial 4 failed with parameters: {'t1_value': 0.009659170709713704, 's_shift_cosine': 1.9996748686525345, 'tau_1': 0.5789499324598648, 'delta_tau_2': 0.1054126250575695} because of the following error: The value nan is not acceptable.
[W 2025-04-17 22:31:15,447] Trial 4 failed with value VariableArray(nan).
[I 2025-04-17 22:46:04,703] Trial 5 finished with value: 0.6262099427716774 and parameters: {'t1_value': 0.0033600768831586122, 's_shift_cosine': 8.166339637704361, 'tau_1': 0.6308829465870414, 'delta_tau_2': 0.37267042312733767}. Best is trial 1 with value: 0.531148347917356.
[I 2025-04-17 23:00:54,738] Trial 6 finished with value: 1.051974823725851 and parameters: {'t1_value': 0.0007542717588329616, 's_shift_cosine': 5.450765769581785, 'tau_1': 0.8939678768604257, 'delta_tau_2': 0.387592764889509}. Best is trial 1 with value: 0.531148347917356.
/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/numpy/lib/function_base.py:4658: RuntimeWarning: invalid value encountered in subtract
  subtract(b, diff_b_a * (1 - t), out=lerp_interpolation, where=t >= 0.5,
[I 2025-04-17 23:15:44,008] Trial 7 finished with value: 0.4898699123608439 and parameters: {'t1_value': 0.0073785035152661915, 's_shift_cosine': 3.8893498303298433, 'tau_1': 0.6966381462158338, 'delta_tau_2': 0.20368005836903744}. Best is trial 7 with value: 0.4898699123608439.
[I 2025-04-17 23:30:34,075] Trial 8 finished with value: 0.4948735174170712 and parameters: {'t1_value': 0.003905021690566058, 's_shift_cosine': 4.130308379564607, 'tau_1': 0.8309230493577155, 'delta_tau_2': 0.11860365040527805}. Best is trial 7 with value: 0.4898699123608439.
[W 2025-04-17 23:45:20,200] Trial 9 failed with parameters: {'t1_value': 0.007276572261327124, 's_shift_cosine': 3.299864104118094, 'tau_1': 0.4477521637246009, 'delta_tau_2': 0.30228531233643946} because of the following error: The value nan is not acceptable.
[W 2025-04-17 23:45:20,201] Trial 9 failed with value VariableArray(nan).
[I 2025-04-18 00:00:10,376] Trial 10 finished with value: 0.8844936824681466 and parameters: {'t1_value': 0.005117563786952284, 's_shift_cosine': 7.264190911826796, 'tau_1': 0.46523565918791177, 'delta_tau_2': 0.12037131153131778}. Best is trial 7 with value: 0.4898699123608439.
[W 2025-04-18 00:14:34,237] Trial 11 failed with parameters: {'t1_value': 0.0004910813301134049, 's_shift_cosine': 1.8652484041196937, 'tau_1': 0.7396504175796238, 'delta_tau_2': 0.059406624931558884} because of the following error: The value nan is not acceptable.
[W 2025-04-18 00:14:34,238] Trial 11 failed with value VariableArray(nan).
[I 2025-04-18 00:29:21,783] Trial 12 finished with value: 0.43067602803832605 and parameters: {'t1_value': 0.008472345887613229, 's_shift_cosine': 4.089164893119303, 'tau_1': 0.5520652633606078, 'delta_tau_2': 0.22277443916973583}. Best is trial 12 with value: 0.43067602803832605.
/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/numpy/lib/function_base.py:4655: RuntimeWarning: invalid value encountered in subtract
  diff_b_a = subtract(b, a)
[W 2025-04-18 00:43:17,127] Trial 13 failed with parameters: {'t1_value': 0.009987296394465162, 's_shift_cosine': 0.8999640153450383, 'tau_1': 0.43339986962028665, 'delta_tau_2': 0.0004298381709312016} because of the following error: The value nan is not acceptable.
[W 2025-04-18 00:43:17,127] Trial 13 failed with value VariableArray(nan).
[W 2025-04-18 00:57:11,273] Trial 14 failed with parameters: {'t1_value': 0.009840885568686513, 's_shift_cosine': 0.8550975869063682, 'tau_1': 0.4300059326605853, 'delta_tau_2': 0.01058670058509495} because of the following error: The value nan is not acceptable.
[W 2025-04-18 00:57:11,273] Trial 14 failed with value VariableArray(nan).
/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/numpy/lib/function_base.py:4657: RuntimeWarning: invalid value encountered in add
  lerp_interpolation = asanyarray(add(a, diff_b_a * t, out=out))
[W 2025-04-18 01:11:23,590] Trial 15 failed with parameters: {'t1_value': 0.009431493837151335, 's_shift_cosine': 1.2984821922313161, 'tau_1': 0.4070448715167602, 'delta_tau_2': 0.01198773615959317} because of the following error: The value nan is not acceptable.
[W 2025-04-18 01:11:23,590] Trial 15 failed with value VariableArray(nan).
[W 2025-04-18 01:25:20,539] Trial 16 failed with parameters: {'t1_value': 0.009471937641309639, 's_shift_cosine': 0.9358713361674154, 'tau_1': 0.42440965118373253, 'delta_tau_2': 0.2934923171437647} because of the following error: The value nan is not acceptable.
[W 2025-04-18 01:25:20,539] Trial 16 failed with value VariableArray(nan).
[W 2025-04-18 01:37:53,596] Trial 17 failed with parameters: {'t1_value': 0.009876323542183785, 's_shift_cosine': 0.3297683122896151, 'tau_1': 0.4015370089863076, 'delta_tau_2': 0.005230627173856778} because of the following error: The value nan is not acceptable.
[W 2025-04-18 01:37:53,597] Trial 17 failed with value VariableArray(nan).
[W 2025-04-18 01:51:01,160] Trial 18 failed with parameters: {'t1_value': 0.009630087522005067, 's_shift_cosine': 0.9660193082559747, 'tau_1': 0.4029932860072214, 'delta_tau_2': 0.013143763505559375} because of the following error: The value nan is not acceptable.
[W 2025-04-18 01:51:01,161] Trial 18 failed with value VariableArray(nan).
/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/numpy/core/_methods.py:118: RuntimeWarning: overflow encountered in reduce
  ret = umr_sum(arr, axis, dtype, out, keepdims, where=where)
[W 2025-04-18 02:03:58,299] Trial 19 failed with parameters: {'t1_value': 0.009931457551167961, 's_shift_cosine': 0.8184867485558156, 'tau_1': 0.4214341808684803, 'delta_tau_2': 0.010554663320784474} because of the following error: The value nan is not acceptable.
[W 2025-04-18 02:03:58,299] Trial 19 failed with value VariableArray(nan).
Exp: 20 Model: 0 max_results
Kernel type: variance_preserving, noise schedule: cosine
t_min: 0.00035210439818911254, t_max: 0.999647855758667
alpha, sigma: (tensor(1.0000), tensor(0.0006)) (tensor(0.0006), tensor(1.0000))
Moving prior to device: cpu
+--------------------------------------+------------+
|               Modules                | Parameters |
+--------------------------------------+------------+
|        time_embedding.0.scale        |     1      |
|       time_embedding.1.weight        |     64     |
|        time_embedding.1.bias         |     8      |
|       summary_net.enc.0.weight       |     80     |
|        summary_net.enc.0.bias        |     16     |
|       summary_net.enc.2.weight       |    256     |
|        summary_net.enc.2.bias        |     16     |
|       summary_net.enc.4.weight       |    256     |
|        summary_net.enc.4.bias        |     16     |
|       summary_net.enc.6.weight       |    256     |
|        summary_net.enc.6.bias        |     16     |
|       summary_net.dec.0.weight       |    256     |
|        summary_net.dec.0.bias        |     16     |
|       summary_net.dec.2.weight       |    256     |
|        summary_net.dec.2.bias        |     16     |
|       summary_net.dec.4.weight       |    256     |
|        summary_net.dec.4.bias        |     16     |
|       summary_net.dec.6.weight       |     80     |
|        summary_net.dec.6.bias        |     5      |
|   blocks.res_blocks.0.dense.weight   |    4096    |
|    blocks.res_blocks.0.dense.bias    |    256     |
| blocks.res_blocks.0.projector.weight |    4096    |
|   blocks.res_blocks.1.dense.weight   |   65536    |
|    blocks.res_blocks.1.dense.bias    |    256     |
|   blocks.res_blocks.2.dense.weight   |   65536    |
|    blocks.res_blocks.2.dense.bias    |    256     |
|   blocks.res_blocks.3.dense.weight   |   65536    |
|    blocks.res_blocks.3.dense.bias    |    256     |
|   blocks.res_blocks.4.dense.weight   |   65536    |
|    blocks.res_blocks.4.dense.bias    |    256     |
|    final_projection_linear.weight    |    768     |
|     final_projection_linear.bias     |     3      |
+--------------------------------------+------------+
Total Trainable Params: 274273
ar1_3_128global_score_model_v_variance_preserving_cosine_likelihood_weighting
+--------------------------------------+------------+
|               Modules                | Parameters |
+--------------------------------------+------------+
|        time_embedding.0.scale        |     1      |
|       time_embedding.1.weight        |     64     |
|        time_embedding.1.bias         |     8      |
|   blocks.res_blocks.0.dense.weight   |    4352    |
|    blocks.res_blocks.0.dense.bias    |    256     |
| blocks.res_blocks.0.projector.weight |    4352    |
|   blocks.res_blocks.1.dense.weight   |   65536    |
|    blocks.res_blocks.1.dense.bias    |    256     |
|   blocks.res_blocks.2.dense.weight   |   65536    |
|    blocks.res_blocks.2.dense.bias    |    256     |
|   blocks.res_blocks.3.dense.weight   |   65536    |
|    blocks.res_blocks.3.dense.bias    |    256     |
|   blocks.res_blocks.4.dense.weight   |   65536    |
|    blocks.res_blocks.4.dense.bias    |    256     |
|    final_projection_linear.weight    |    256     |
|     final_projection_linear.bias     |     1      |
+--------------------------------------+------------+
Total Trainable Params: 272458
ar1_3_128local_score_model_v_variance_preserving_cosine_likelihood_weighting
+---------------------------------------------------+------------+
|                      Modules                      | Parameters |
+---------------------------------------------------+------------+
|        global_model.time_embedding.0.scale        |     1      |
|        global_model.time_embedding.1.weight       |     64     |
|         global_model.time_embedding.1.bias        |     8      |
|       global_model.summary_net.enc.0.weight       |     80     |
|        global_model.summary_net.enc.0.bias        |     16     |
|       global_model.summary_net.enc.2.weight       |    256     |
|        global_model.summary_net.enc.2.bias        |     16     |
|       global_model.summary_net.enc.4.weight       |    256     |
|        global_model.summary_net.enc.4.bias        |     16     |
|       global_model.summary_net.enc.6.weight       |    256     |
|        global_model.summary_net.enc.6.bias        |     16     |
|       global_model.summary_net.dec.0.weight       |    256     |
|        global_model.summary_net.dec.0.bias        |     16     |
|       global_model.summary_net.dec.2.weight       |    256     |
|        global_model.summary_net.dec.2.bias        |     16     |
|       global_model.summary_net.dec.4.weight       |    256     |
|        global_model.summary_net.dec.4.bias        |     16     |
|       global_model.summary_net.dec.6.weight       |     80     |
|        global_model.summary_net.dec.6.bias        |     5      |
|   global_model.blocks.res_blocks.0.dense.weight   |    4096    |
|    global_model.blocks.res_blocks.0.dense.bias    |    256     |
| global_model.blocks.res_blocks.0.projector.weight |    4096    |
|   global_model.blocks.res_blocks.1.dense.weight   |   65536    |
|    global_model.blocks.res_blocks.1.dense.bias    |    256     |
|   global_model.blocks.res_blocks.2.dense.weight   |   65536    |
|    global_model.blocks.res_blocks.2.dense.bias    |    256     |
|   global_model.blocks.res_blocks.3.dense.weight   |   65536    |
|    global_model.blocks.res_blocks.3.dense.bias    |    256     |
|   global_model.blocks.res_blocks.4.dense.weight   |   65536    |
|    global_model.blocks.res_blocks.4.dense.bias    |    256     |
|    global_model.final_projection_linear.weight    |    768     |
|     global_model.final_projection_linear.bias     |     3      |
|         local_model.time_embedding.0.scale        |     1      |
|        local_model.time_embedding.1.weight        |     64     |
|         local_model.time_embedding.1.bias         |     8      |
|    local_model.blocks.res_blocks.0.dense.weight   |    4352    |
|     local_model.blocks.res_blocks.0.dense.bias    |    256     |
|  local_model.blocks.res_blocks.0.projector.weight |    4352    |
|    local_model.blocks.res_blocks.1.dense.weight   |   65536    |
|     local_model.blocks.res_blocks.1.dense.bias    |    256     |
|    local_model.blocks.res_blocks.2.dense.weight   |   65536    |
|     local_model.blocks.res_blocks.2.dense.bias    |    256     |
|    local_model.blocks.res_blocks.3.dense.weight   |   65536    |
|     local_model.blocks.res_blocks.3.dense.bias    |    256     |
|    local_model.blocks.res_blocks.4.dense.weight   |   65536    |
|     local_model.blocks.res_blocks.4.dense.bias    |    256     |
|     local_model.final_projection_linear.weight    |    256     |
|      local_model.final_projection_linear.bias     |     1      |
+---------------------------------------------------+------------+
Total Trainable Params: 546731
ar1_3_128hierarchical_score_model_v_variance_preserving_cosine_likelihood_weighting
Model loaded
max_results
262144 torch.Size([100, 262144, 5])
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.036000002175569534 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.006000000052154064 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.030000001192092896 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.06599999964237213 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.06800000369548798 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.046000003814697266 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.06200000271201134 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.10200000554323196 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.06000000238418579 with step size: tensor(0.0020, device='cuda:0')
Moving prior to device: cpu
Moving prior to device: cuda:0
NaNs in theta at time 0.07200000435113907 with step size: tensor(0.0020, device='cuda:0')
{'t1_value': 0.008472345887613229, 's_shift_cosine': 4.089164893119303, 'tau_1': 0.5520652633606078, 'delta_tau_2': 0.22277443916973583}
Moving prior to device: cpu
Moving prior to device: cuda:0
Moving prior to device: cpu
Moving prior to device: cuda:0
Traceback (most recent call last):
  File "/home/jarruda_hpc/hierarchical-abi/ar(1)_score_matching.py", line 415, in <module>
    fig = diagnostics.recovery(posterior_global_samples_test, true_global, variable_names=global_param_names)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/bayesflow/diagnostics/plots/recovery.py", line 93, in recovery
    plot_data = prepare_plot_data(
                ^^^^^^^^^^^^^^^^^^
  File "/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/bayesflow/utils/plot_utils.py", line 56, in prepare_plot_data
    plot_data = dicts_to_arrays(
                ^^^^^^^^^^^^^^^^
  File "/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/bayesflow/utils/dict_utils.py", line 300, in dicts_to_arrays
    targets = make_variable_array(
              ^^^^^^^^^^^^^^^^^^^^
  File "/home/jarruda_hpc/.conda/envs/habi/lib/python3.11/site-packages/bayesflow/utils/dict_utils.py", line 223, in make_variable_array
    raise TypeError(f"Only dicts and tensors are supported as arguments, but your estimates are of type {type(x)}")
TypeError: Only dicts and tensors are supported as arguments, but your estimates are of type <class 'torch.Tensor'>
